<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Area - My First Website</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>Private Area</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="documents.html">Documents</a></li>
                <li><a href="login.html">Private Area</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="private-content">
            <h2>Welcome to the Private Area</h2>
            <p>This content is only accessible to you and your friends who know the password. Also to those who access this page in the public repo.</p>

            <div class="private-section">
                <h3>Secret Messages</h3>
                <p>Here's where you can share private information with your friends.</p>

                <div class="message">
                    <h4>April 15, 2025</h4>
                    <p>Welcome to our private section! This area is only visible to people who know the password.</p>
                </div>

                <div class="message">
                    <h4>April 14, 2025</h4>
                    <p>Feel free to add more content here that you only want to share with trusted friends.</p>
                </div>
            </div>

            <div class="dev-work-section">
                <h3>Development Work</h3>
                <p>Here you can find some of my development projects:</p>

                <ul class="dev-projects">
                    <li>
                        <a href="dev-work/hangman-dos.html">MS-DOS Hangman Game</a>
                        <span class="project-desc">A classic word guessing game implemented in MS-DOS</span>
                    </li>
                </ul>
            </div>

            <button id="logout-button" type="button" style="margin-top: 20px;" aria-label="Logout from private area">Logout</button>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 My First Website</p>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // Enhanced authentication check and logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Validate authentication token
            function validateAuthToken() {
                const authToken = sessionStorage.getItem('authToken');
                const username = sessionStorage.getItem('username');
                const authenticated = sessionStorage.getItem('authenticated');
                
                // Check if we have both new token-based auth and legacy auth
                return (authToken && username) || (authenticated === 'true');
            }

            // Check if user is authenticated
            console.log('Checking authentication status...');

            if (!validateAuthToken()) {
                console.log('User not authenticated, redirecting to login...');
                // Clear any potentially corrupted session data
                sessionStorage.clear();
                // Redirect to login page if not authenticated
                window.location.href = 'login.html';
                return;
            }

            console.log('User authenticated, loading private area...');

            // Display username if available
            const username = sessionStorage.getItem('username');
            if (username) {
                // Update welcome message to include username
                const welcomeSection = document.querySelector('#private-content h2');
                if (welcomeSection) {
                    welcomeSection.textContent = `Welcome to the Private Area, ${username}!`;
                }
            }

            // Enhanced logout functionality
            const logoutButton = document.getElementById('logout-button');

            if (logoutButton) {
                logoutButton.addEventListener('click', function() {
                    console.log('Logout button clicked');
                    
                    // Clear all authentication data
                    sessionStorage.removeItem('authenticated');
                    sessionStorage.removeItem('authToken');
                    sessionStorage.removeItem('username');
                    sessionStorage.removeItem('loginTime');
                    
                    // Optional: Also clear any rate limiting data on logout
                    // localStorage.removeItem('loginAttempts');

                    console.log('Session cleared, redirecting to login...');
                    // Redirect to login page
                    window.location.href = 'login.html';
                });
            }

            // Optional: Add session timeout (example: 2 hours)
            const loginTime = sessionStorage.getItem('loginTime');
            if (loginTime) {
                const sessionDuration = 2 * 60 * 60 * 1000; // 2 hours in milliseconds
                const loginTimestamp = new Date(loginTime).getTime();
                const currentTime = Date.now();
                
                if (currentTime - loginTimestamp > sessionDuration) {
                    console.log('Session expired, redirecting to login...');
                    sessionStorage.clear();
                    window.location.href = 'login.html';
                    return;
                }
            }
        });
    </script>
</body>
</html>